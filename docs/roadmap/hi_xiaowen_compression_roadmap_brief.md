# hi_xiaowen 压缩路线精简版

## 背景与目标

- baseline：`HEAD=2599`，参数约 `756K`。
- 已证明：权重手术可在精度基本不降的情况下大幅减参。
- 当前目标：把最终可用模型压到 `~135K`。

## 已完成：第一步（权重手术）

| 方案 | 关键词 | 参数量 | Accuracy | FRR | FAR(/h) |
|---|---|---:|---:|---:|---:|
| baseline_4gpus | 嗨小问 | 756K | 98.38% | 1.62% | 0.64 |
| baseline_4gpus | 你好问问 | 756K | 98.05% | 1.95% | 0.28 |
| top20_weight_surgery | 嗨小问 | 392K | 98.88% | 1.12% | 0.67 |
| top20_weight_surgery | 你好问问 | 392K | 98.63% | 1.37% | 0.32 |

- 结论：`756K -> 392K`（约 `-48.1%`），精度与 baseline 基本一致。

## 进行中：第二步（top20 教师蒸馏 mini 学生）

- 教师：`top20_weight_surgery/test_79`，分数样例约 `0.62~0.78`（首条 `0.648`）。
- 学生：`distill_mini/test_26`，分数样例约 `0.40~0.43`。
- 当前结果（`test_26`，threshold=0.000）：
  - 嗨小问：FAR `93.9545/h`，FRR `0.1973%`
  - 你好问问：FAR `0.2920/h`，FRR `54.3182%`

- 结论：学生约 `~138K`（可按 `~135K`），但当前判别不平衡，尚不可部署。

## 下一步方案（含预期）

## 方案 A（主线）

`HEAD440 教师（80 epoch） -> 蒸馏 HEAD440 学生 -> surgery 到 HEAD20`

- 预期模型大小：
  - 教师（440）：`~451K`
  - 学生（440 mini）：`~176K`
  - 最终（surgery 到 20）：`~136K`
- 预期精度目标：
  - 440 学生：`FRR < 5%`，`FAR <= 1/h`
  - 最终 20-head：`FRR < 8%`，`FAR <= 1/h`

## 方案 B（A 失败兜底）

`HEAD2599 教师 -> HEAD2599 学生蒸馏 -> surgery 到 HEAD20`

- 预期模型大小：
  - 2599-head 学生（mini backbone）：`~386K`
  - 最终（surgery 到 20）：`~136K`
- 预期精度目标：先接近 baseline，再落到 20-head 并尽量保持同量级 FAR/FRR。

## 方案 C（保底）

`使用徐博轻量 backbone（HEAD2599） -> surgery 到 HEAD20`

- 预期模型大小：`backbone_params + (output_affine_dim * 20 + 20)`。
- 说明：当前仓库内尚缺该路线的完整可引用指标文件，待补齐后可并入主表。
